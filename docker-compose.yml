services:

  srv:
    build:
      context: .
      target: final
    command: ["/bin/srv"]
    ports:
      - "50051:50051"
    restart: unless-stopped

  # Client 1 — aggregated BTCUSDT 1m (Binance + Bybit + OKX)
  client-btcusdt:
    build:
      context: .
      target: final
    command: ["/bin/client"]
    environment:
      SERVER_ADDR: srv:50051
      SYMBOL:      BTCUSDT
      INTERVAL:    1m
    depends_on:
      - srv
    restart: on-failure

  # Client 2 — aggregated ETHUSDT 1m
  client-ethusdt:
    build:
      context: .
      target: final
    command: ["/bin/client"]
    environment:
      SERVER_ADDR: srv:50051
      SYMBOL:      ETHUSDT
      INTERVAL:    1m
    depends_on:
      - srv
    restart: on-failure

  # Client 3 — aggregated SOLUSDT 1m
  client-solusdt:
    build:
      context: .
      target: final
    command: ["/bin/client"]
    environment:
      SERVER_ADDR: srv:50051
      SYMBOL:      SOLUSDT
      INTERVAL:    1m
    depends_on:
      - srv
    restart: on-failure
